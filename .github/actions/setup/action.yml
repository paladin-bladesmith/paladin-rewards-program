name: Setup environment

inputs:
  cache:
    description: Enable caching
    default: "true"
  node:
    description: The Node.js version to install
    required: true
  solana:
    description: The Solana version to install

runs:
  using: "composite"
  steps:
    - name: Set env vars
      run: |
        source ci/rust-version.sh
        echo "RUST_NIGHTLY=$rust_nightly" >> $GITHUB_ENV
      shell: bash
    - name: Setup pnpm
      uses: pnpm/action-setup@v3
    - name: Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: ${{ inputs.node }}
        cache: "pnpm"
    - name: Install dependencies
      run: pnpm install --frozen-lockfile
      shell: bash
    - name: Install Rust Nightly
      uses: dtolnay/rust-toolchain@master
      with:
        toolchain: ${{ env.RUST_NIGHTLY }}
        components: rustfmt
    - name: Install Solana
      if: ${{ inputs.solana != '' }}
      uses: metaplex-foundation/actions/install-solana@v1
      with:
        version: ${{ inputs.solana }}
        cache: ${{ inputs.cache }}
